<script>
const GAME_CODE='الحمدالله1';
let codeUsed=false; // للتحقق من استخدام الرمز مرة واحدة
const FAMILY_LINK='https://www.facebook.com/profile.php?id=61581366775114';

let playerName='',currentQ=0,score=0,timeLeft=60,timerInterval;

const welcomeCard=document.getElementById('welcomeCard');
const messageCard=document.getElementById('messageCard');
const quizCard=document.getElementById('quizCard');
const resultCard=document.getElementById('resultCard');
const nameInput=document.getElementById('nameInput');
const codeInput=document.getElementById('codeInput');
const startBtn=document.getElementById('startBtn');
const welcomeMsg=document.getElementById('welcomeMsg');
const questionArea=document.getElementById('questionArea');
const timerEl=document.getElementById('timer');
const timerBar=document.getElementById('timerBar');
const feedback=document.getElementById('feedback');
const resultText=document.getElementById('resultText');
const playerResultName=document.getElementById('playerResultName');
const copyBtn=document.getElementById('copyBtn');
const goFamilyBtn=document.getElementById('goFamilyBtn');
const restartBtn=document.getElementById('restartBtn');

startBtn.onclick=()=>{
    const name=nameInput.value.trim();
    const code=codeInput.value.trim();
    if(!name){alert('الرجاء إدخال الاسم');return;}
    if(codeUsed){alert('⚠️ تم استخدام هذا الرمز مسبقاً ولا يمكن الدخول مرة أخرى'); return;}
    if(code!==GAME_CODE){alert('الرمز غير صحيح');return;}
    
    playerName=name;
    codeUsed=true; // يتم تفعيل الرمز مرة واحدة
    welcomeCard.classList.add('hidden');
    messageCard.classList.remove('hidden');
    welcomeMsg.textContent=`أهلاً بك ${name} في عائلة نعومتك 💖`;
    setTimeout(()=>{messageCard.classList.add('hidden');startQuiz();},5000);
}

function startQuiz(){
    quizCard.classList.remove('hidden');
    currentQ=0;score=0;
    showQuestion();
    startTimer();
}

function startTimer(){
    clearInterval(timerInterval);
    timeLeft=60;
    updateTimer();
    timerInterval=setInterval(()=>{
        timeLeft--;
        updateTimer();
        if(timeLeft<=0){nextQuestion();}
    },1000);
}

function updateTimer(){
    timerEl.textContent=`${String(Math.floor(timeLeft/60)).padStart(2,'0')}:${String(timeLeft%60).padStart(2,'0')}`;
    timerBar.style.width=(timeLeft/60*100)+'%';
}

function showQuestion(){
    if(currentQ>=QUESTIONS.length){finishQuiz();return;}
    timeLeft=60;updateTimer();feedback.textContent='';
    const q=QUESTIONS[currentQ];
    let html=`<h3>سؤال ${currentQ+1}: ${q.q}</h3><div class="options">`;
    q.opts.forEach((o,i)=>{html+=`<div class="opt" onclick="selectOption(${i})">${o}</div>`;});
    html+='</div>';
    questionArea.innerHTML=html;
}

function selectOption(i){
    const q=QUESTIONS[currentQ];
    if(i===q.a){score+=10;feedback.textContent=`إجابة صحيحة ✅`;}
    else{feedback.textContent=`إجابة خاطئة ❌`;}
    setTimeout(()=>{nextQuestion();},1500);
}

function nextQuestion(){
    currentQ++;
    if(currentQ<QUESTIONS.length)showQuestion();else finishQuiz();
}

function finishQuiz(){
    clearInterval(timerInterval);
    quizCard.classList.add('hidden');
    resultCard.classList.remove('hidden');
    playerResultName.textContent=playerName;
    resultText.textContent=`لقد حصلت على ${score} من ${QUESTIONS.length*10} نقطة!`;
}

copyBtn.onclick=async()=>{await navigator.clipboard.writeText(resultText.textContent);alert('✅ تم نسخ النتيجة!');}
goFamilyBtn.onclick=()=>{window.open(FAMILY_LINK,'_blank');}

// تعديل زر إعادة اللعبة
restartBtn.onclick=()=>{
    alert('ههههه لقد خدعناكي 😝');
    setTimeout(()=>{
        resultCard.classList.remove('hidden'); // إعادة ظهور صفحة النتيجة بعد 10 ثواني
    },10000);
}
</script>
